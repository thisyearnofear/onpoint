<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnPoint Fashion AI</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                <h1>OnPoint Fashion AI</h1>
            </div>
            <div class="chrome-ai-status" id="aiStatus">
                <span class="status-indicator" id="statusIndicator"></span>
                <span class="status-text" id="statusText">Checking AI...</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Photo Upload Section -->
            <section class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2v11z"/>
                            <circle cx="12" cy="13" r="4"/>
                        </svg>
                    </div>
                    <h3>Upload Outfit Photo</h3>
                    <p>Drag & drop or click to select an image</p>
                    <input type="file" id="photoInput" accept="image/*" hidden>
                    <button class="upload-btn" id="uploadBtn">
                        Select Photo
                    </button>
                </div>

                <!-- Photo Preview -->
                <div class="photo-preview" id="photoPreview" style="display: none;">
                    <img id="previewImg" alt="Selected outfit">
                    <button class="remove-photo" id="removePhoto" title="Remove photo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <!-- Mode Toggle -->
                <div class="mode-toggle">
                    <label class="toggle-label">
                    <input type="checkbox" id="virtualTryOnToggle">
                <span class="toggle-slider"></span>
                Virtual Try-On Mode
                </label>
                <small style="color: #6b7280; font-size: 11px;">Get text descriptions of how outfits would look instead of analysis</small>
                </div>

                <!-- Saved Photos -->
                <div class="saved-photos" id="savedPhotosSection" style="display: none;">
                    <h4>Saved Photos</h4>
                    <div class="saved-photos-grid" id="savedPhotosGrid"></div>
                </div>
            </section>

            <!-- Analysis Section -->
            <section class="analysis-section" id="analysisSection" style="display: none;">
                <div class="loading-state" id="loadingState">
                    <div class="spinner"></div>
                    <p>Analyzing your outfit with AI...</p>
                </div>

                <div class="results" id="results" style="display: none;">
                    <div class="rating-card">
                        <div class="rating-header">
                            <h3>Style Rating</h3>
                            <div class="rating-score" id="ratingScore">-</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-fill" id="ratingFill"></div>
                        </div>
                        <p class="rating-text" id="ratingText">Overall assessment</p>
                    </div>

                    <div class="strengths-card">
                        <h3>✨ What's Working</h3>
                        <ul id="strengthsList"></ul>
                    </div>

                    <div class="improvements-card">
                        <h3>💡 Suggestions</h3>
                        <ul id="improvementsList"></ul>
                    </div>

                    <div class="style-notes">
                        <h3>🎨 Style Notes</h3>
                        <p id="styleNotesText"></p>
                    </div>
                </div>
            </section>

            <!-- Action Buttons -->
            <div class="actions" id="actions" style="display: none;">
            <button class="action-btn secondary" id="analyzeBtn">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            </svg>
            Analyze Outfit
            </button>
            <button class="action-btn primary" id="getAdviceBtn">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"/>
            </svg>
            Get Styling Advice
            </button>
            <button class="action-btn outline" id="compareBtn">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            </svg>
            Compare with Product
            </button>
            <button class="action-btn secondary" id="savePhotoBtn">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                    Save Photo
                </button>
                <button class="action-btn secondary" id="saveBtn" style="display: none;">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>
                    </svg>
                    Save Analysis
                </button>
            </div>

            <!-- Diagnostics Panel -->
            <section class="diagnostics-card" id="diagnosticsCard">
                <div class="diagnostics-header" id="diagnosticsToggle">
                    <div class="diag-title">
                        <svg class="diag-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                        <h3>Diagnostics</h3>
                    </div>
                    <button class="diag-refresh" id="diagnosticsRefresh">Recheck</button>
                </div>
                <div class="diagnostics-body" id="diagnosticsBody">
                    <div class="diag-row">
                        <span class="diag-label">Server API</span>
                        <span class="diag-badge" id="diagServerStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Server Providers</span>
                        <span class="diag-badge" id="diagProvidersStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Server Model</span>
                        <span>
                            <select id="serverModelSelect" style="font-size:12px; padding:4px 6px; border:1px solid #d1d5db; border-radius:4px;">
                                <option value="flash">Flash (fast)</option>
                                <option value="pro">Pro (detailed)</option>
                                <option value="flash-lite">Flash Lite (cheapest)</option>
                            </select>
                        </span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Prompt Model</span>
                        <span class="diag-badge" id="diagPromptStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Lite Mode</span>
                        <span class="diag-badge" id="diagLiteStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Origin Trial (Extension)</span>
                        <span class="diag-badge" id="diagOTExtStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Origin Trial (Pages)</span>
                        <span class="diag-badge" id="diagOTPageStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Translator</span>
                        <span class="diag-badge" id="diagTranslatorStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Language Detector</span>
                        <span class="diag-badge" id="diagLangDetectStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Proofreader</span>
                        <span class="diag-badge" id="diagProofreaderStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Writer</span>
                        <span class="diag-badge" id="diagWriterStatus">Unknown</span>
                    </div>
                    <div class="diag-row">
                        <span class="diag-label">Rewriter</span>
                        <span class="diag-badge" id="diagRewriterStatus">Unknown</span>
                    </div>
                    <div style="margin-top: 8px; padding: 8px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px;">
                        <div style="font-size: 12px; color: #374151; margin-bottom: 6px;">Page Origin Trial token (third-party):</div>
                        <div style="display:flex; gap:8px;">
                            <input id="otTokenInput" type="text" placeholder="Paste token for pages (third-party)" style="flex:1; font-size:12px; padding:6px 8px; border:1px solid #d1d5db; border-radius:4px;" />
                            <button id="saveOTTokenBtn" class="diag-refresh" style="font-size:12px;">Save Token</button>
                        </div>
                        <div style="font-size: 11px; color: #6b7280; margin-top: 6px;">Saved token is injected by the content script into pages you visit.</div>
                    </div>
                    <div class="diag-note" id="diagNote"></div>
                </div>
            </section>


            <!-- Styling Advice Modal -->
            <div class="modal-overlay" id="modalOverlay" style="display: none;">
                <div class="modal">
                    <div class="modal-header">
                        <h3>AI Styling Advice</h3>
                        <button class="close-modal" id="closeModal">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="modal-content">
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages"></div>
                            <div class="chat-input">
                                <input type="text" id="messageInput" placeholder="Ask for styling advice..." maxlength="200">
                                <button id="sendMessage" disabled>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="22" y1="2" x2="11" y2="13"></line>
                                        <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                                    </svg>
                                </button>
                            </div>
                            <div class="chat-options" style="padding: 0 16px 12px 16px;">
                                <label class="toggle-label" style="font-size: 12px;">
                                    <input type="checkbox" id="translateAdviceToggle" />
                                    <span class="toggle-slider"></span>
                                    Translate advice to UI language
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error State -->
            <div class="error-card" id="errorCard" style="display: none;">
                <div class="error-icon">⚠️</div>
                <h3>Something went wrong</h3>
                <p id="errorText"></p>
                <button class="retry-btn" id="retryBtn">Try Again</button>
            </div>

            <!-- Chrome AI Not Available -->
            <div class="warning-card" id="chromeAIWarning" style="display: none;">
                <div class="warning-icon">ℹ️</div>
                <h3>Chrome AI Required</h3>
                <p>This extension requires Chrome's Built-in AI APIs. Please ensure you're using Chrome 138+ with AI features enabled.</p>
                <a href="https://developer.chrome.com/docs/ai" target="_blank" class="learn-more">Learn More</a>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="powered-by">
                <span>Powered by</span>
                <strong>Chrome Built-in AI</strong>
            </div>
            <div class="links">
                <a href="#" id="aboutLink">About</a>
                <a href="#" id="privacyLink">Privacy</a>
            </div>
        </footer>
    </div>

    <script src="scripts/apiClient.js"></script>
    <script src="popup.js"></script>
</body>
</html>
